{% extends 'base.html' %}
{% load article_functions %}
{% block header %}
    <title>Task {{ task.title }}</title>
{% endblock %}
{% block content %}
    {{ block.super }}
    <h2>Task: {{ task.title }}</h2>
    <div><b>General info:</b>
        <ul>
            <li>Unit: {{ task.unit }}</li>
            <li>Section: {{ task.section }}</li>
            <li>Description: {{ task.description }}</li>
            <li>Total value: {{ task.task_value }} PLN</li>
            <li>Engagement: {{ task.engagement|floatformat:2 }} PLN</li>
            <li>Performance: {{ task.performance|floatformat:2 }} PLN</li>
        </ul>
    </div>
    <div>
        <b>Financial Plan - Articles:</b>
        {% for article in task.task_articles.all %}

            <ul> {% if article.value != 0 %}
                <li>{{ article.article.total_number }}, value: {{ article.value }} PLN ,
                    engagement: {% task_article_engagement article.article task  %} PLN,
                    performance: {% task_article_performance article.article task %} PLN
                </li>{% endif %}
            </ul>

        {% endfor %}

    </div>
    {% if task.engagement %}
    <div>
        <b>Contracts:</b>
        <table border="bold">
            <thead>
            <tr>
                <td>Id</td>
                <td>Number</td>
                <td>Contractor</td>
                <td>Date</td>
                <td>Value</td>
                <td>Performance</td>
            </tr>
            </thead>
            <tbody>
            {% for contract in task.contracts.all %}
                <tr>
                    <td>{{ forloop.counter }}</td>
                    <td><a href="{{ contract.get_absolute_url }}">{{ contract.number }}</a></td>
                    <td>{{ contract.contractor }}</td>
                    <td>{{ contract.date }}</td>
                    <td>{{ contract.contract_value|floatformat:2 }} </td>
                    <td>{{ contract.contract_performance|floatformat:2 }}</td>
                </tr>
            {% empty %} No contracts for task
            {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
        <div>
        No contracts for task. You can add a new one in menu <a href="{% url 'budget:contracts' %}">contracts.</a>
        </div>
    {% endif %}
    {% if task.performance %}
        <div>
        <h3><a href="{% url 'budget:task-findocs' task.id %}">Financial documents for task - details</a></h3>
        </div>
    {% else %}
        <div>
        No financial document for task. You can add a new one in contract details.
        </div>
    {% endif %}
    <h3><a href="{% url 'budget:edit_task' task.id %}">Edit task general info</a></h3>
    <h3><a href="{% url 'budget:task_edit_articles' task.id %}">Edit articles in task</a></h3>
    <h3><a href="{% url 'budget:delete_task' task.id %}">Delete task</a></h3>


{% endblock %}